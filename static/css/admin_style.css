/* --- CSS DASAR ADMIN LAYOUT --- */
body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f4f7f6;
    font-size: 16px;
}
.admin-header-main { 
    background-color: #00A6FF; 
    color: white;
    padding: 0 20px; 
    display: flex;
    align-items: center;
    justify-content: flex-start;
    flex-shrink: 0;
    height: 65px; 
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: fixed; 
    top: 0;
    left: 0; 
    right: 0;
    z-index: 1030; 
}
.sidebar-toggle-btn { 
    background: none; border: none; color: white;
    font-size: 1.5em; 
    margin-right: 15px; 
    cursor: pointer; padding: 8px; line-height: 1; 
}
.sidebar-toggle-btn:hover {
    background-color: rgba(255,255,255,0.15);
    border-radius: 4px;
}
.admin-header-main .site-title {
    font-size: 1.5em; 
    font-weight: 600; 
    margin: 0;
}
.admin-body-container {
    display: flex;
    flex-grow: 1;
    margin-top: 65px; 
}
.admin-sidebar { 
    width: 260px;
    background-color: #ffffff; 
    flex-shrink: 0;
    border-right: 1px solid #e9ecef; 
    box-shadow: 2px 0 6px rgba(0,0,0,0.05); 
    transition: width 0.3s ease, transform 0.3s ease; 
    position: fixed; 
    left: 0; top: 65px; bottom: 0; 
    z-index: 1020;
    display: flex; 
    flex-direction: column; 
    overflow-y: auto;
}
.admin-sidebar-header { 
    padding: 20px 25px; 
    border-bottom: 1px solid #f0f2f5; 
}
.admin-sidebar-header .sidebar-site-title {
    font-size: 1.25em; font-weight: 600; color: #343a40; margin: 0;
}
.admin-sidebar-header .sidebar-site-subtitle {
    font-size: 0.85em; color: #6c757d; margin: 0;
}
.admin-sidebar nav { flex-grow: 1; margin-top: 10px; }
.admin-sidebar nav ul { list-style-type: none; padding: 0; margin: 0; }
.admin-sidebar nav ul li a {
    display: flex; align-items: center;
    padding: 13px 25px; 
    color: #495057; text-decoration: none;
    font-size: 0.98em;
    border-left: 4px solid transparent; 
    transition: all 0.2s ease;
}
.admin-sidebar nav ul li a:hover {
    background-color: #f8f9fa; color: #007bff; 
}
.admin-sidebar nav ul li a.active { 
    background-color: #e9f5ff; color: #0056b3; 
    font-weight: 600; border-left-color: #007bff; 
}
.admin-sidebar nav ul li a .menu-icon { 
    margin-right: 15px; width: 22px; text-align: center;
    font-size: 1.1em; color: #6c757d; transition: color 0.2s ease;
}
.admin-sidebar nav ul li a.active .menu-icon,
.admin-sidebar nav ul li a:hover .menu-icon {
    color: #007bff; 
}
.sidebar-footer-links { margin-top: auto; padding: 10px 0; border-top: 1px solid #e9ecef; }
.sidebar-footer-links ul { list-style-type: none; padding: 0; margin: 0; }
.sidebar-footer-links ul li a {
    display: flex; align-items: center;
    padding: 13px 25px; 
    color: #495057; text-decoration: none;
    font-size: 0.98em;
    transition: all 0.2s ease;
}
.sidebar-footer-links ul li a:hover {
    background-color: #f8f9fa; color: #007bff;
}
 .sidebar-footer-links ul li a:hover .menu-icon {
    color: #007bff;
}
.admin-content { 
    flex-grow: 1;
    padding: 25px 30px; 
    background-color: #f0f2f5; 
    overflow-y: auto;
    margin-left: 260px;
    transition: margin-left 0.3s ease; 
}
.admin-content .page-header-title {
    font-size: 1.8em; color: #343a40; 
    margin-top: 0; margin-bottom: 25px; 
}
.content-wrapper { 
    background-color: #ffffff;
    padding: 25px; border-radius: 8px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.07);
}

/* --- STYLE UNTUK FORM --- */
.form-group {
    margin-bottom: 22px;
}
.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #495057;
    font-size: 0.9em;
}
.form-control, .form-select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ced4da;
    border-radius: 5px;
    box-sizing: border-box;
    font-size: 0.95em;
    background-color: #fff;
    color: #495057;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}
.form-control::placeholder {
    color: #868e96;
    opacity: 1;
}
.form-control:focus, .form-select:focus {
    border-color: #007bff;
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
}
textarea.form-control {
    min-height: 100px;
    resize: vertical;
}
.current-cover-label, .current-ebook-label {
    font-size: 0.85em;
    color: #6c757d;
    margin-bottom: 5px;
    display: block;
}
.current-file-link { font-weight: 500; color: #007bff; }
.current-file-link:hover { text-decoration: underline; }
.cover-preview, .current-cover-display {
    max-width: 180px; max-height: 220px; 
    margin-top: 8px; border: 1px solid #e0e0e0;
    padding: 4px; border-radius: 4px;
    object-fit: contain; background-color: #f8f9fa;
}
.cover-preview { display: none; }
.current-cover-display { display: block; }
.custom-file-input-wrapper {
    position: relative; overflow: hidden;
    display: flex; width: 100%;
    border: 1px solid #ced4da; border-radius: 6px;
}
.custom-file-input-wrapper input[type=file] {
    font-size: 100px; position: absolute;
    left: 0; top: 0; opacity: 0; cursor: pointer;
    width: 100%; height: 100%; 
}
.custom-file-input-button { 
    background-color: #e9ecef; color: #495057;
    padding: 10px 15px; white-space: nowrap;
    border-right: 1px solid #ced4da;
}
.custom-file-input-label { 
    padding: 10px 12px; flex-grow: 1; 
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    font-size: 0.95em; color: #6c757d;
    background-color: #fff; 
}
#stok_fisik_group, #file_ebook_group { display: none; }
.form-check-input { margin-right: 0.5em; }

/* --- STYLE TOMBOL --- */
.btn { 
    display: inline-flex; 
    align-items: center; justify-content: center;
    padding: 10px 20px; 
    font-size: 0.95em;  
    font-weight: 600;
    border-radius: 5px; text-decoration: none;
    cursor: pointer; border: 1px solid transparent;
    transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
    white-space: nowrap; 
}
.btn i.fas, .btn i.far { 
    margin-right: 8px;
}
.btn-sm { 
    padding: 6px 12px;
    font-size: 0.85em;
}
.btn-theme-primary { /* Tombol Aksi Utama Minimalis (Biru Tema Header) */
    background-color: #00A6FF;
    border-color: #00A6FF;
    color: white;
}
.btn-theme-primary:hover {
    background-color: #008bdb; 
    border-color: #0082c8;
}
.btn-theme-cancel { /* Tombol Batal/Sekunder Minimalis (Outline) */
    background-color: transparent;
    border-color: #6c757d; 
    color: #495057; 
}
.btn-theme-cancel:hover {
    background-color: #f8f9fa; 
    border-color: #5a6268;
    color: #343a40;
}
.btn-detail { background-color: #007bff; color: #fff; border-color: #007bff;}
.btn-detail:hover { background-color: #0056b3; border-color: #0052cc;}
.btn-admin { background-color: #28a745; color: #fff; border-color: #28a745;} 
.btn-admin:hover { background-color: #218838; border-color: #1e7e34;}
.btn-success { background-color: #28a745; color: #fff; border-color: #28a745;}
.btn-success:hover { background-color: #218838; border-color: #1e7e34;}
.btn-danger { background-color: #dc3545; color: #fff; border-color: #dc3545;} 
.btn-danger:hover { background-color: #c82333; border-color: #bd2130;}
.btn-warning { background-color: #ffc107; color: #212529; border-color: #ffc107;}
.btn-warning:hover { background-color: #e0a800; border-color: #d39e00;}
.btn-info { background-color: #17a2b8; color: #fff; border-color: #17a2b8;} 
.btn-info:hover { background-color: #138496; border-color: #117a8b;}
.btn-secondary { background-color: #6c757d; color: #fff; border-color: #6c757d;}
.btn-secondary:hover { background-color: #5a6268; border-color: #545b62;}
.btn-promote-admin { background-color: #5856d6; color: #fff; border-color: #5856d6;} 
.btn-promote-admin:hover { background-color: #434190; border-color: #3e3c82;}
.btn-demote-admin { background-color: #a4a4a4; color: #fff; border-color: #a4a4a4;} 
.btn-demote-admin:hover { background-color: #8c8c8c; border-color: #828282;}

/* --- STYLE TABEL DATA --- */
.table-responsive-wrapper { width: 100%; overflow-x: auto; }
.data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
.data-table th, .data-table td { padding: 14px 16px; border: 1px solid #dee2e6; text-align: left; font-size: 0.95em; vertical-align: middle; }
.data-table thead th { background-color: #f1f3f5; font-weight: 600; color: #495057; }
.data-table tbody tr:nth-of-type(even) { background-color: #f8f9fa; }
.data-table tbody tr:hover { background-color: #f1f7ff; }
.action-buttons a, .action-buttons button { margin-right: 5px; margin-bottom: 5px; }

/* --- STYLE BADGE & STATUS --- */
.badge { display: inline-block; padding: .35em .65em; font-size: .75em; font-weight: 700; line-height: 1; color: #fff; text-align: center; white-space: nowrap; vertical-align: baseline; border-radius: .25rem; }
.bg-secondary { background-color: #6c757d !important; }
.bg-warning { background-color: #ffc107 !important; color: #212529 !important; }
.bg-info { background-color: #17a2b8 !important; }
.status-text { font-weight: bold; padding: 3px 7px; border-radius: 4px; color: #fff; }
.status-dikembalikan { background-color: #28a745; }
.status-terlambat_dikembalikan { background-color: #dc3545; }
.status-dipinjam { background-color: #007bff; }
.status-menunggu_konfirmasi_admin { background-color: #ffc107; color: #212529;}
.status-diunduh { background-color: #17a2b8; }
.status-pending { color: #b08500; font-weight: bold; background-color: #fff3cd; padding: 3px 7px; border-radius: 4px;}
.status-approved { color: #198754; font-weight: bold; background-color: #d1e7dd; padding: 3px 7px; border-radius: 4px;}
.status-rejected { color: #dc3545; font-weight: bold; background-color: #f8d7da; padding: 3px 7px; border-radius: 4px;}


/* --- FOOTER & RESPONSIVE SIDEBAR --- */
.admin-footer { text-align: center; padding: 15px; background-color: #ffffff; color: #6c757d; font-size: 0.85em; border-top: 1px solid #e9ecef; margin-left: 260px; transition: margin-left 0.3s ease; }
.admin-sidebar.desktop-minimized { width: 72px; }
.admin-sidebar.desktop-minimized .admin-sidebar-header .sidebar-site-title,
.admin-sidebar.desktop-minimized .admin-sidebar-header .sidebar-site-subtitle,
.admin-sidebar.desktop-minimized nav ul li a .link-text,
.admin-sidebar.desktop-minimized .sidebar-footer-links .link-text { display: none; }
.admin-sidebar.desktop-minimized nav ul li a,
.admin-sidebar.desktop-minimized .sidebar-footer-links ul li a { justify-content: center; padding-left:0; padding-right:0; }
 .admin-sidebar.desktop-minimized nav ul li a .menu-icon,
 .admin-sidebar.desktop-minimized .sidebar-footer-links ul li a .menu-icon { margin-right: 0; font-size: 1.3em; }
.admin-content.sidebar-minimized,
.admin-footer.sidebar-minimized { margin-left: 72px; }
.mobile-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 1015; }
.mobile-overlay.active { display: block; }

/* --- STYLE SPESIFIK HALAMAN (Dashboard, Reports, User Detail, dll.) --- */
/* Style untuk Kartu Laporan & Dashboard */
.report-summary-cards, .dashboard-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Disesuaikan agar lebih fleksibel */
    gap: 20px;
    margin-bottom: 30px;
}
.summary-card, .stat-card {
    background-color: #fff;
    padding: 20px; /* Padding konsisten */
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    display: flex; /* Untuk stat-card agar ikon dan info sejajar */
    align-items: center;
    gap: 15px; /* Spasi antara ikon dan info di stat-card */
}
.summary-card { /* Penyesuaian untuk summary-card jika perlu */
    text-align: center;
    border-left: 5px solid #007bff; /* Aksen default */
}
.summary-card.fines { border-left-color: #ffc107; }
.summary-card.physical-loans { border-left-color: #28a745; }
.summary-card.digital-loans { border-left-color: #17a2b8; }
.summary-card.action-requests { border-left-color: #fd7e14;}


.summary-card h4, .stat-card .stat-info h4 {
    margin-top: 0; font-size: 1em; color: #555; font-weight: 600; margin-bottom: 8px;
}
.summary-card .value, .stat-card .stat-info .stat-value {
    font-size: 2em; font-weight: bold; color: #333; margin: 5px 0 10px 0;
}
.summary-card .description, .stat-card .stat-info .description { /* Penambahan .description untuk stat-card jika ada */
    font-size: 0.85em; color: #777;
}
.stat-card .stat-icon { /* Style ikon untuk dashboard */
    font-size: 2.2em; /* Sedikit lebih kecil dari sebelumnya */
    padding: 12px;   /* Padding disesuaikan */
    border-radius: 50%;
    color: #fff;
    display: flex; align-items: center; justify-content: center;
    width: 50px; height: 50px; /* Ukuran ikon disesuaikan */
}
.icon-books { background-color: #007bff; } 
.icon-users { background-color: #28a745; } 
.icon-loans { background-color: #ffc107; } 
.icon-pending { background-color: #17a2b8; } 
.icon-librarians { background-color: #6f42c1; } 
.icon-action-requests { background-color: #fd7e14; }

/* Grid Menu Dashboard */
.admin-menu-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px; margin-top: 20px;
}
.menu-item a {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    background-color: #fff; padding: 25px 15px; border-radius: 8px;
    text-decoration: none; color: #495057; box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    text-align: center; min-height: 120px;
}
.menu-item a:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); color: #007bff; }
.menu-item a .menu-icon { font-size: 2.2em; margin-bottom: 12px; color: #007bff; }
.menu-item a .menu-icon.icon-add { color: #28a745; }
.menu-item a .menu-icon.icon-list { color: #17a2b8; }
.menu-item a .menu-icon.icon-users-manage { color: #6f42c1; }
.menu-item a .menu-icon.icon-confirm { color: #fd7e14; } 
.menu-item a .menu-icon.icon-active-loans { color: #dc3545; } 
.menu-item a .menu-icon.icon-reports { color: #343a40; } 

/* Aktivitas Terbaru Dashboard */
.recent-activities { margin-top: 30px; }
.recent-activities h3 { font-weight: 500; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
.activity-list { list-style: none; padding: 0; }
.activity-list li { background-color: #fff; padding: 12px 15px; border-radius: 5px; margin-bottom: 8px; font-size: 0.95em; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
.activity-list li .timestamp { font-size: 0.8em; color: #777; display: block; margin-top: 3px; }

/* Style untuk user_detail.html & action_requests.html & pending_loans.html */
.user-detail-card, .loan-history-card, .action-requests-card, .request-section, .loan-request-card {
    background-color: #fff; padding: 25px; border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.07); margin-bottom: 25px;
}
.user-detail-card h3, .loan-history-card h3, .action-requests-card h3, .request-section h3, .loan-request-card h4 {
    margin-top: 0; font-size: 1.3em; color: #333;
    padding-bottom: 10px; border-bottom: 1px solid #eee; margin-bottom: 20px;
}
.loan-request-card h4 { font-size: 1.1em; } /* Khusus untuk pending loans */

.detail-item { display: flex; margin-bottom: 12px; font-size: 0.95em; }
.detail-item strong { width: 180px; color: #555; flex-shrink: 0; }
.detail-item span { color: #333; }
.profile-photo-container { max-width: 150px; margin-bottom: 15px; }
.profile-photo-container img { width: 100%; height: auto; border-radius: 8px; border: 3px solid #eee; }
.status-aktif { color: #28a745; font-weight: bold; }
.status-nonaktif { color: #dc3545; font-weight: bold; }
.no-data, .no-requests { color: #777; font-style: italic; padding: 15px 0; }
.no-requests { text-align: center; background-color: #f9f9f9; border-radius: 8px; }

.request-details p, .loan-details p { margin: 8px 0; font-size: 0.95em; line-height: 1.6; }
.request-details strong, .loan-details strong { color: #555; min-width: 150px; display: inline-block; }
.request-actions, .loan-actions { margin-top: 20px; padding-top: 15px; border-top: 1px dashed #eee; }
.request-actions textarea {
    width: 100%; min-height: 60px; padding: 10px; border-radius: 4px;
    border: 1px solid #ccc; margin-bottom: 10px; box-sizing: border-box;
    font-family: inherit; font-size: 0.95em;
}
.request-actions .btn { margin-right: 10px; }
.table-actions form { margin-bottom: 0; }
.nl2br-text p { margin-top: 0; margin-bottom: 0.5em; }
.nl2br-text p:last-child { margin-bottom: 0; }


@media (max-width: 768px) {
    .admin-sidebar { transform: translateX(-100%); width: 250px; z-index: 1040; }
    .admin-sidebar.mobile-open { transform: translateX(0); }
    .admin-sidebar.desktop-minimized { width: 250px; }
    .admin-sidebar.desktop-minimized .admin-sidebar-header .sidebar-site-title,
    .admin-sidebar.desktop-minimized .admin-sidebar-header .sidebar-site-subtitle,
    .admin-sidebar.desktop-minimized nav ul li a .link-text,
    .admin-sidebar.desktop-minimized .sidebar-footer-links .link-text { display: block; }
    .admin-sidebar.desktop-minimized nav ul li a,
    .admin-sidebar.desktop-minimized .sidebar-footer-links ul li a { justify-content: flex-start; padding: 13px 25px; }
     .admin-sidebar.desktop-minimized nav ul li a .menu-icon,
     .admin-sidebar.desktop-minimized .sidebar-footer-links ul li a .menu-icon { margin-right: 15px; font-size: 1.1em; }
    .admin-content, .admin-footer { margin-left: 0 !important; }
    .row { flex-direction: column; gap: 0px !important; }
    .form-group { margin-bottom: 15px; }
    .btn { padding: 8px 15px; font-size: 0.9em; }
    .btn i.fas { margin-right: 6px;}
    .report-summary-cards, .dashboard-stats { grid-template-columns: 1fr; } /* Kartu jadi 1 kolom di mobile */
}

    </style>
    {% block head_extra %}{% endblock %}
</head>
<body>
    <header class="admin-header-main"> 
        <button class="sidebar-toggle-btn" id="sidebarToggleBtn" title="Toggle Sidebar">
            <i class="fas fa-bars"></i> 
        </button>
        <h1 class="site-title">Digi Pustaka</h1>
    </header>

    <div class="admin-body-container">
        <aside class="admin-sidebar" id="adminSidebar"> 
            <div class="admin-sidebar-header">
                <h2 class="sidebar-site-title">Digi Pustaka</h2>
                <p class="sidebar-site-subtitle">
                    {% if g_user.role == 'admin' %}
                        Panel Super Admin
                    {% elif g_user.role == 'pustakawan' %}
                        Panel Pustakawan
                    {% else %} 
                        Menu Staf
                    {% endif %}
                </p>
            </div>
            <nav>
                <ul>
                    {% if g_user.role in ['admin', 'pustakawan'] %}
                        <li><a href="{{ url_for('admin_dashboard') }}" class="{{ 'active' if request.endpoint == 'admin_dashboard' else '' }}"><span class="menu-icon"><i class="fas fa-tachometer-alt"></i></span><span class="link-text">Dashboard</span></a></li>
                        <li><a href="{{ url_for('admin_list_books') }}" class="{{ 'active' if request.endpoint in ['admin_list_books', 'admin_add_book', 'admin_edit_book'] else '' }}"><span class="menu-icon"><i class="fas fa-book"></i></span><span class="link-text">Manajemen Buku</span></a></li>
                        <li><a href="{{ url_for('admin_pending_loans') }}" class="{{ 'active' if request.endpoint == 'admin_pending_loans' else '' }}"><span class="menu-icon"><i class="fas fa-hourglass-half"></i></span><span class="link-text">Konfirmasi Pinjaman</span></a></li>
                        <li><a href="{{ url_for('admin_active_loans') }}" class="{{ 'active' if request.endpoint in ['admin_active_loans', 'admin_edit_fine'] else '' }}"><span class="menu-icon"><i class="fas fa-exchange-alt"></i></span><span class="link-text">Peminjaman Aktif</span></a></li>
                        <li><a href="{{ url_for('admin_list_users') }}" class="{{ 'active' if request.endpoint in ['admin_list_users', 'admin_user_detail', 'admin_view_action_requests'] else '' }}"><span class="menu-icon"><i class="fas fa-users"></i></span><span class="link-text">Manajemen Pengguna</span></a></li>
                    {% endif %}

                    {% if g_user.role == 'admin' %}
                        <li><a href="{{ url_for('admin_view_action_requests') }}" class="{{ 'active' if request.endpoint == 'admin_view_action_requests' else '' }}"><span class="menu-icon"><i class="fas fa-tasks"></i></span><span class="link-text">Permintaan Aksi Staf</span></a></li>
                        <li><a href="{{ url_for('admin_reports') }}" class="{{ 'active' if request.endpoint == 'admin_reports' else '' }}"><span class="menu-icon"><i class="fas fa-chart-line"></i></span><span class="link-text">Laporan</span></a></li>
                    {% endif %}
                </ul>
            </nav>
            <div class="sidebar-footer-links">
                <ul>
                    <li><a href="{{ url_for('logout') }}"><span class="menu-icon"><i class="fas fa-sign-out-alt"></i></span><span class="link-text">Logout</span></a></li>
                    <li><a href="{{ url_for('index') }}" target="_blank"><span class="menu-icon"><i class="fas fa-external-link-alt"></i></span><span class="link-text">Lihat Situs</span></a></li>
                </ul>
            </div>
        </aside>

        <main class="admin-content" id="adminMainContent"> 
            <h2 class="page-header-title">{% block page_title %}{% endblock %}</h2>
            
            <div class="content-wrapper"> 
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category if category != 'message' else 'info' }} alert-dismissible fade show" role="alert">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <footer class="admin-footer" id="adminFooter"> 
        <p>&copy; {{ current_year }} Digi Pustaka - Panel Staf</p>
    </footer>

    <script>
    // JavaScript tetap sama
    document.addEventListener('DOMContentLoaded', function() {
        const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
        const adminSidebar = document.getElementById('adminSidebar');
        const adminMainContent = document.getElementById('adminMainContent');
        const adminFooter = document.getElementById('adminFooter');
        const mobileOverlay = document.getElementById('mobileOverlay');
        const body = document.body;
        
        const isDesktop = () => window.innerWidth > 768;

        function applyDesktopState(isMinimized) {
            if (isMinimized) {
                adminSidebar.classList.add('desktop-minimized');
                adminMainContent.classList.add('sidebar-minimized');
                if (adminFooter) adminFooter.classList.add('sidebar-minimized');
                sidebarToggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
                sidebarToggleBtn.setAttribute('title', 'Perluas Sidebar');
            } else {
                adminSidebar.classList.remove('desktop-minimized');
                adminMainContent.classList.remove('sidebar-minimized');
                if (adminFooter) adminFooter.classList.remove('sidebar-minimized');
                sidebarToggleBtn.innerHTML = '<i class="fas fa-times"></i>';
                sidebarToggleBtn.setAttribute('title', 'Perkecil Sidebar');
            }
        }

        function toggleMobileSidebar(show) {
            if (show === undefined) { 
                adminSidebar.classList.toggle('mobile-open');
            } else if (show) { 
                adminSidebar.classList.add('mobile-open');
            } else { 
                adminSidebar.classList.remove('mobile-open');
            }

            if (adminSidebar.classList.contains('mobile-open')) {
                mobileOverlay.classList.add('active');
                body.style.overflow = 'hidden'; 
                sidebarToggleBtn.innerHTML = '<i class="fas fa-times"></i>';
            } else {
                mobileOverlay.classList.remove('active');
                body.style.overflow = '';
                sidebarToggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
            }
        }

        sidebarToggleBtn.addEventListener('click', function() {
            if (isDesktop()) {
                const isMinimized = adminSidebar.classList.contains('desktop-minimized');
                applyDesktopState(!isMinimized);
                localStorage.setItem('sidebarMinimized', !isMinimized);
            } else {
                toggleMobileSidebar(); 
            }
        });

        mobileOverlay.addEventListener('click', function() {
            toggleMobileSidebar(false); 
        });

        if (isDesktop()) {
            const sidebarState = localStorage.getItem('sidebarMinimized') === 'true';
            applyDesktopState(sidebarState);
        } else {
            sidebarToggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
        }

        window.addEventListener('resize', () => {
            if (isDesktop()) {
                toggleMobileSidebar(false); 
                const sidebarState = localStorage.getItem('sidebarMinimized') === 'true';
                applyDesktopState(sidebarState); 
            } else {
                adminSidebar.classList.remove('desktop-minimized'); 
                adminMainContent.classList.remove('sidebar-minimized');
                if(adminFooter) adminFooter.classList.remove('sidebar-minimized');
                if (!adminSidebar.classList.contains('mobile-open')) {
                    sidebarToggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
                }
            }
        });
    });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>