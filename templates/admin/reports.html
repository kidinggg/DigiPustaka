{% extends "admin/admin_base.html" %}

{% block title %}{{ title }} - Admin Digi Pustaka{% endblock %}

{% block head_extra %}
<style>
    /* Styling spesifik untuk kartu statistik jika diperlukan */
    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .stat-card {
        background-color: #f1f3f5; padding: 20px; border-radius: 8px;
        text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .stat-card h4 { 
        margin-top: 0; margin-bottom: 10px; font-size: 1.1em; color: #495057;
    }
    .stat-card .stat-value { font-size: 1.8em; font-weight: bold; color: #343a40; }
    .stat-card p.desc { font-size: 0.85em; color: #6c757d; margin-top: 5px; }
</style>
{% endblock %}

{% block content %}
<div class="admin-content-area">
    <h2>{{ title }}</h2>

    <h3>Statistik Umum Peminjaman</h3>
    <div class="stats-container">
        <div class="stat-card">
            <h4>Total Peminjaman</h4>
            <div class="stat-value">{{ total_loans }}</div>
            <p class="desc">Semua jenis buku</p>
        </div>
        <div class="stat-card">
            <h4>Peminjaman Buku Fisik</h4>
            <div class="stat-value">{{ physical_loans }}</div>
            <p class="desc">Buku yang dipinjam secara fisik</p>
        </div>
        <div class="stat-card">
            <h4>Unduhan Buku Digital</h4>
            <div class="stat-value">{{ digital_loans }}</div>
            <p class="desc">Buku digital yang diunduh</p>
        </div>
        <div class="stat-card">
            <h4>Total Denda Terkumpul</h4>
            <div class="stat-value">Rp {{ "{:,.0f}".format(total_fines_collected) }}</div>
            <p class="desc">Dari pengembalian buku fisik</p>
        </div>
    </div>
    
    <hr style="margin: 40px 0;">

    <h3>Buku Terpopuler (Paling Sering Dipinjam)</h3>
    {% if popular_books %}
        <div class="admin-table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Peringkat</th>
                        <th>Judul Buku</th>
                        <th>Jumlah Peminjaman</th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in popular_books %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ book.judul }}</td>
                        <td>{{ book.jumlah_peminjaman }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="no-data">Belum ada data peminjaman untuk menampilkan buku terpopuler.</p>
    {% endif %}

    <hr style="margin: 40px 0;">

    <h3>Pengguna dengan Akumulasi Denda Terbanyak</h3>
    {% if users_with_most_fines %}
        <div class="admin-table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Peringkat</th>
                        <th>Nama Pengguna</th>
                        <th>Nomor Anggota</th>
                        <th>Total Denda (Rp)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user_fine in users_with_most_fines %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ user_fine.nama_lengkap }}</td>
                        <td>{{ user_fine.nomor_anggota }}</td>
                        <td>{{ "{:,.0f}".format(user_fine.total_denda) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="no-data">Tidak ada pengguna dengan catatan denda.</p>
    {% endif %}
    
    <div style="margin-top: 30px; text-align: center;">
        <p><em>Laporan lebih detail akan ditambahkan di masa mendatang.</em></p>
    </div>
</div>
{% endblock %}
